/**
 * Bestiary Prompt — v1
 *
 * Generates a complete creature entry including:
 * - Structured stats, abilities, weaknesses
 * - Narrative description and lore connection
 * - SVG portrait (inline, generated by the LLM)
 *
 * The SVG generation demonstrates creative structured output:
 * the LLM produces valid SVG code as part of its JSON response,
 * which is then rendered directly in the UI.
 */

import { HABITATS, LORE_CONNECTIONS } from "./world";

export function buildCreaturePrompt({ creatureType, habitat, role, element, dangerLevel }) {
  const habitatInfo = HABITATS.find((h) => h.id === habitat);

  return `Tu es un illustrateur et game designer expert spécialisé dans la création de créatures pour un bestiaire de RPG médiéval-fantasy. Tu travailles dans l'univers de Cendrebourg.

## CONTEXTE DU MONDE
Cendrebourg est un village fortifié assombri par des disparitions mystérieuses liées au Cercle d'Obsidienne, une organisation occulte. La magie corrompue affecte la faune et la flore environnante.

## HABITAT DE LA CRÉATURE
${habitatInfo ? `**${habitatInfo.name}** : ${habitatInfo.description}` : "Habitat libre dans la région de Cendrebourg"}

## TA MISSION
Génère UNE créature de type "${creatureType}" avec un rôle de "${role}", d'élément "${element}", de niveau de danger ${dangerLevel}/5, habitant "${habitatInfo?.name || "la région de Cendrebourg"}".

## RÈGLES
1. La créature doit être originale et mémorable — pas de loup géant générique
2. Le nom doit être évocateur et prononçable (pas de noms à 15 syllabes)
3. Les stats doivent refléter le type, le rôle et le niveau de danger
4. Les faiblesses doivent être exploitables tactiquement par un joueur
5. La description doit évoquer l'ambiance sombre de Cendrebourg
6. Le portrait SVG doit être un emblème/blason stylisé de la créature (style héraldique médiéval), pas un dessin réaliste

## PORTRAIT SVG — INSTRUCTIONS CRITIQUES
Tu dois générer un portrait SVG valide de la créature. Règles strictes :
- ViewBox : exactement "0 0 200 200"
- Utilise UNIQUEMENT : <circle>, <rect>, <ellipse>, <polygon>, <path>, <line>, <text>
- Palette : fond sombre (#1a1520 ou similaire), formes en couleurs de l'élément + blanc/gris
- Style : emblème héraldique / blason médiéval, géométrique et symbolique
- PAS de <image>, PAS de <foreignObject>, PAS de CSS externe
- Le SVG doit avoir un fond (rect plein) et un cadre/bordure décoratif
- Maximum 20 éléments SVG pour rester lisible
- N'utilise PAS de caractères spéciaux dans les textes SVG

## FORMAT DE RÉPONSE — JSON STRICT
Réponds UNIQUEMENT avec un JSON valide :

{
  "name": "Nom de la créature",
  "title": "Titre/épithète court (ex: 'Le Rôdeur de Brume', 'Sentinelle Pétrifiée')",
  "type": "${creatureType}",
  "element": "${element}",
  "role": "${role}",
  "danger_level": ${dangerLevel},
  "habitat": "${habitat}",
  "description": "Description narrative atmosphérique (3-4 phrases, ambiance sombre)",
  "appearance": "Description physique détaillée (2-3 phrases)",
  "behavior": "Comment la créature se comporte, chasse, ou interagit (2-3 phrases)",
  "stats": {
    "hp": 1-100,
    "attack": 1-20,
    "defense": 1-20,
    "speed": 1-20,
    "intelligence": 1-20,
    "perception": 1-20
  },
  "abilities": [
    { "name": "Nom de la capacité", "description": "Effet en 1 phrase", "cooldown": "passif/1 tour/3 tours" }
  ],
  "weaknesses": [
    { "name": "Nom de la faiblesse", "description": "Comment l'exploiter en 1 phrase" }
  ],
  "loot": [
    { "name": "Nom de l'objet", "description": "Description courte", "drop_rate": "commun/rare/très rare" }
  ],
  "lore_connection": "Lien avec l'intrigue principale de Cendrebourg (1-2 phrases)",
  "encounter_tip": "Conseil tactique pour un aventurier affrontant cette créature (1 phrase)",
  "svg_portrait": "<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'>...</svg>"
}

Ne mets RIEN avant ou après le JSON.`;
}
